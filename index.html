<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CBT IPS SMP</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#f4f6f8;
}
.container{
  max-width:480px;
  margin:auto;
  background:white;
  min-height:100vh;
  padding:16px;
}
h2{text-align:center}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:16px;
}
button{
  background:#2563eb;
  color:white;
  border:none;
  border-radius:6px;
}
button:disabled{background:#aaa}
.soal{
  margin-top:20px;
}
.opsi label{
  display:block;
  padding:10px;
  margin-top:8px;
  border:1px solid #ddd;
  border-radius:6px;
}
.hidden{display:none}
.timer{
  text-align:center;
  font-weight:bold;
  color:#dc2626;
}
</style>
</head>

<body>
<div class="container">

<!-- IDENTITAS -->
<div id="login">
  <h2>Ujian IPS</h2>
  <input id="nisn" placeholder="Masukkan NISN">
  <button onclick="mulai()">MULAI UJIAN</button>
</div>

<!-- TIMER -->
<div id="timer" class="timer hidden"></div>

<!-- SOAL -->
<div id="soalBox" class="hidden">
  <div class="soal">
    <div id="pertanyaan"></div>
    <div class="opsi" id="opsi"></div>
  </div>
  <button onclick="nextSoal()">SOAL BERIKUTNYA</button>
</div>

<!-- SELESAI -->
<div id="selesai" class="hidden">
  <h2>Ujian Selesai</h2>
  <p>Terima kasih telah mengerjakan.</p>
</div>

</div>

<script>
/* ================== KONFIGURASI ================== */
const URL_API = "URL_APPS_SCRIPT_ANDA";
const waktuUjian = 20 * 60; // 20 menit

/* ================== DATA SOAL ================== */
const soal = [
  {
    tanya:"Perubahan sosial yang terjadi secara lambat disebut?",
    opsi:["Revolusi","Evolusi","Konflik","Disintegrasi"],
    benar:1
  },
  {
    tanya:"Contoh integrasi sosial dalam masyarakat majemuk adalah?",
    opsi:["Tawuran","Gotong royong","Diskriminasi","Konflik"],
    benar:1
  }
];

/* ================== VARIABEL ================== */
let index = 0;
let skor = 0;
let timer = waktuUjian;

/* ================== LOGIN ================== */
function mulai(){
  const nisn = document.getElementById("nisn").value;
  if(!nisn){ alert("NISN wajib diisi"); return;}

  fetch(URL_API,{
    method:"POST",
    body:JSON.stringify({nisn:nisn})
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status!=="ok"){
      alert("NISN tidak terdaftar!");
      return;
    }
    document.getElementById("login").classList.add("hidden");
    document.getElementById("soalBox").classList.remove("hidden");
    document.getElementById("timer").classList.remove("hidden");
    startTimer();
    tampilSoal();
  });
}

/* ================== TAMPIL SOAL ================== */
function tampilSoal(){
  const s = soal[index];
  document.getElementById("pertanyaan").innerHTML =
    `<b>Soal ${index+1}</b><br>${s.tanya}`;

  let html="";
  s.opsi.forEach((o,i)=>{
    html+=`
    <label>
      <input type="radio" name="opsi" value="${i}">
      ${o}
    </label>`;
  });
  document.getElementById("opsi").innerHTML=html;
}

/* ================== NEXT ================== */
function nextSoal(){
  const jawab = document.querySelector("input[name='opsi']:checked");
  if(!jawab){alert("Pilih jawaban!");return;}
  if(parseInt(jawab.value)===soal[index].benar) skor++;

  index++;
  if(index>=soal.length){
    selesaiUjian();
  }else{
    tampilSoal();
  }
}

/* ================== TIMER ================== */
function startTimer(){
  setInterval(()=>{
    timer--;
    const m=Math.floor(timer/60);
    const d=timer%60;
    document.getElementById("timer").innerText=
      `Sisa waktu: ${m}:${d<10?"0"+d:d}`;
    if(timer<=0) selesaiUjian();
  },1000);
}

/* ================== SELESAI ================== */
function selesaiUjian(){
  document.getElementById("soalBox").classList.add("hidden");
  document.getElementById("timer").classList.add("hidden");
  document.getElementById("selesai").classList.remove("hidden");

  const nilai = Math.round((skor/soal.length)*100);

  fetch(URL_API,{
    method:"POST",
    body:JSON.stringify({
      nisn: document.getElementById("nisn").value,
      nilai: nilai
    })
  });
}
</script>

</body>
</html>
