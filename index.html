<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CBT IPS SMP</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#f4f6f8;
}
.container{
  max-width:480px;
  margin:auto;
  background:white;
  min-height:100vh;
  padding:16px;
}
h2{text-align:center}
input,button{
  width:100%;
  padding:14px;
  margin-top:10px;
  font-size:16px;
}
button{
  background:#2563eb;
  color:white;
  border:none;
  border-radius:6px;
  font-weight:bold;
}
button:disabled{background:#aaa}
.timer{
  text-align:center;
  font-weight:bold;
  color:#dc2626;
  margin-top:10px;
}
.soal{
  margin-top:20px;
}
.opsi label{
  display:block;
  padding:12px;
  margin-top:8px;
  border:1px solid #ddd;
  border-radius:6px;
}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<!-- LOGIN -->
<div id="login">
  <h2>UJIAN IPS</h2>
  <input id="nisn" placeholder="Masukkan NISN">
  <button onclick="mulai()">MULAI UJIAN</button>
</div>

<!-- TIMER -->
<div id="timer" class="timer hidden"></div>

<!-- SOAL -->
<div id="soalBox" class="hidden">
  <div class="soal">
    <div id="pertanyaan"></div>
    <div class="opsi" id="opsi"></div>
  </div>
  <button onclick="nextSoal()">SOAL BERIKUTNYA</button>
</div>

<!-- SELESAI -->
<div id="selesai" class="hidden">
  <h2>Ujian Selesai</h2>
  <p>Terima kasih telah mengerjakan.</p>
  <p id="nilaiAkhir"></p>
</div>

</div>

<script>
/* ================== KONFIGURASI ================== */
const URL_API = "URL_APPS_SCRIPT_ANDA";
const WAKTU_UJIAN = 20 * 60; // 20 menit

/* ================== DATA SOAL ================== */
const soal = [
  {
    tanya:"Perubahan sosial yang terjadi secara lambat disebut?",
    opsi:["Revolusi","Evolusi","Konflik","Disintegrasi"],
    benar:1
  },
  {
    tanya:"Contoh integrasi sosial dalam masyarakat majemuk adalah?",
    opsi:["Tawuran","Gotong royong","Diskriminasi","Konflik"],
    benar:1
  }
];

/* ================== VARIABEL ================== */
let index = 0;
let skor = 0;
let waktu = WAKTU_UJIAN;
let nisnSiswa = "";
let timerInterval;

/* ================== LOGIN (TOKEN = NISN) ================== */
function mulai(){
  const nisn = document.getElementById("nisn").value.trim();
  if(!nisn){
    alert("NISN wajib diisi!");
    return;
  }

  fetch(URL_API,{
    method:"POST",
    body:JSON.stringify({ nisn: nisn })
  })
  .then(res=>res.json())
  .then(res=>{
    if(res.status!=="ok"){
      alert("NISN tidak terdaftar!");
      return;
    }

    nisnSiswa = nisn;

    document.getElementById("login").classList.add("hidden");
    document.getElementById("soalBox").classList.remove("hidden");
    document.getElementById("timer").classList.remove("hidden");

    startTimer();
    tampilSoal();
  });
}

/* ================== TAMPIL SOAL ================== */
function tampilSoal(){
  const s = soal[index];
  document.getElementById("pertanyaan").innerHTML =
    `<b>Soal ${index+1} dari ${soal.length}</b><br>${s.tanya}`;

  let html="";
  s.opsi.forEach((o,i)=>{
    html+=`
    <label>
      <input type="radio" name="opsi" value="${i}">
      ${o}
    </label>`;
  });
  document.getElementById("opsi").innerHTML=html;
}

/* ================== NEXT ================== */
function nextSoal(){
  const jawab = document.querySelector("input[name='opsi']:checked");
  if(!jawab){
    alert("Pilih jawaban!");
    return;
  }

  if(parseInt(jawab.value) === soal[index].benar){
    skor++;
  }

  index++;
  if(index >= soal.length){
    selesaiUjian();
  }else{
    tampilSoal();
  }
}

/* ================== TIMER ================== */
function startTimer(){
  timerInterval = setInterval(()=>{
    waktu--;
    const m = Math.floor(waktu/60);
    const d = waktu%60;
    document.getElementById("timer").innerText =
      `Sisa waktu: ${m}:${d<10?"0"+d:d}`;

    if(waktu <= 0){
      clearInterval(timerInterval);
      selesaiUjian();
    }
  },1000);
}

/* ================== SELESAI ================== */
function selesaiUjian(){
  clearInterval(timerInterval);

  document.getElementById("soalBox").classList.add("hidden");
  document.getElementById("timer").classList.add("hidden");
  document.getElementById("selesai").classList.remove("hidden");

  const nilai = Math.round((skor/soal.length)*100);
  document.getElementById("nilaiAkhir").innerHTML =
    `<b>Nilai Akhir: ${nilai}</b>`;

  fetch(URL_API,{
    method:"POST",
    body:JSON.stringify({
      nisn: nisnSiswa,
      nilai: nilai
    })
  });
}
</script>

</body>
</html>
